<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/>
  <title>Calculator</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">



  <style>
    :root {
      --bg-dark: #030712;
      --bg-glass: rgba(17, 24, 39, 0.75);
      --key-bg: rgba(255, 255, 255, 0.04);
      --key-hover: rgba(255, 255, 255, 0.1);
      --primary: #2563eb;
      --secondary: #1e40af;
      --accent: #3b82f6;
      --text-main: #f8fafc;
      --text-muted: #94a3b8;
      --border-color: rgba(255, 255, 255, 0.08);
      --font-head: 'Space Grotesk', sans-serif;
      --font-body: 'Outfit', sans-serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html,body { height: 100%; }

    body {
      font-family: var(--font-body);
      background-color: var(--bg-dark);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 32px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .ambient-glow {
      position: fixed;
      width: 420px;
      height: 420px;
      background: radial-gradient(circle, rgba(37,99,235,0.12) 0%, transparent 70%);
      border-radius: 50%;
      top: -140px;
      left: -120px;
      z-index: 0;
      filter: blur(60px);
      animation: float 10s infinite ease-in-out;
      pointer-events: none;
    }
    .ambient-glow.secondary {
      top: auto;
      bottom: -140px;
      left: auto;
      right: -120px;
      background: radial-gradient(circle, rgba(30,64,175,0.12) 0%, transparent 70%);
      animation: float 15s infinite ease-in-out reverse;
    }
    @keyframes float {
      0%,100% { transform: translate(0,0); }
      50% { transform: translate(30px,30px); }
    }

    .calc {
      position: relative;
      z-index: 5;
      width: min(360px, 98vw);
      background: var(--bg-glass);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
    }

    .display {
      background: rgba(0,0,0,0.28);
      color: var(--text-main);
      font-family: var(--font-head);
      font-size: clamp(1.4rem, 4vw, 2.2rem);
      text-align: right;
      padding: 22px;
      border-radius: 14px;
      margin-bottom: 16px;
      min-height: 72px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      word-break: break-all;
      border: 1px solid rgba(255,255,255,0.03);
      position: relative;
    }

    .display .sub {
      position: absolute;
      left: 18px;
      top: 12px;
      font-size: 0.75rem;
      color: var(--text-muted);
      font-family: var(--font-body);
    }

    .keys {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    button.key {
      -webkit-tap-highlight-color: transparent;
      appearance: none;
      border: 1px solid var(--border-color);
      background: var(--key-bg);
      color: var(--text-muted);
      border-radius: 12px;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      font-size: 1.05rem;
      font-weight: 600;
      padding: 18px 10px;
      cursor: pointer;
      transition: all 0.14s cubic-bezier(.4,0,.2,1);
      user-select: none;
    }

    button.key:hover { background: var(--key-hover); color: #fff; transform: translateY(-3px); border-color: rgba(255,255,255,0.15); }
    button.key:active { transform: translateY(1px); }

    button.key.op { color: var(--primary); font-family: var(--font-head); font-weight: 700; }
    button.key.clear { color: var(--accent); background: rgba(244,114,182,0.05); }
    button.key.equal {
      background: var(--primary);
      color: white; font-weight: 700; border: none;
    }
    button.key.equal:hover { box-shadow: 0 0 20px rgba(37,99,235,0.28); }

    button.key.zero { grid-column: span 2; aspect-ratio: 2 / 1; }
    button.key:focus { outline: 3px solid rgba(139,92,246,0.18); outline-offset: 2px; }

    @media (max-width: 380px) {
      .display { padding: 18px; min-height: 60px; }
      button.key { padding: 14px 8px; font-size: 1rem; }
    }
  </style>
</head>
<body>
  <div class="ambient-glow" aria-hidden="true"></div>
  <div class="ambient-glow secondary" aria-hidden="true"></div>

  <div class="calc" role="application" aria-label="Calculator">
    <div class="display" id="display" aria-live="polite" aria-atomic="true">
      <div class="sub" id="subDisplay">Ans: 0</div>
      <div id="mainDisplay">0</div>
    </div>

    <div class="keys" role="group" aria-label="Calculator keys">
      <button class="key clear" data-key="AC">AC</button>
      <button class="key clear" data-key="DEL">DEL</button>
      <button class="key op" data-key="Ans">Ans</button>
      <button class="key op" data-key="÷">÷</button>
      <button class="key" data-key="7">7</button>
      <button class="key" data-key="8">8</button>
      <button class="key" data-key="9">9</button>
      <button class="key op" data-key="×">×</button>
      <button class="key" data-key="4">4</button>
      <button class="key" data-key="5">5</button>
      <button class="key" data-key="6">6</button>
      <button class="key op" data-key="-">-</button>
      <button class="key" data-key="1">1</button>
      <button class="key" data-key="2">2</button>
      <button class="key" data-key="3">3</button>
      <button class="key op" data-key="+">+</button>
      <button class="key zero" data-key="0">0</button>
      <button class="key op" data-key="%">%</button>
      <button class="key equal" data-key="=">=</button>
    </div>
  </div>

  <script>
    (function () {
      const mainDisplay = document.getElementById('mainDisplay');
      const subDisplay = document.getElementById('subDisplay');
      const keys = Array.from(document.querySelectorAll('button.key'));

      let current = '';
      let lastResult = '0';
      const operators = ['+', '-', '×', '÷', '*', '/'];

      function isOperatorChar(ch) {
        return operators.includes(ch);
      }

      function updateDisplays() {
        mainDisplay.textContent = current || '0';
        subDisplay.textContent = `Ans: ${lastResult}`;
      }

      function toJsExpression(expr) {
        return expr.replace(/×/g, '*').replace(/÷/g, '/');
      }

      function trimTrailingOperator(expr) {
        return expr.replace(/[+\-×÷*\/]$/, '');
      }

      function insert(val) {
        if (/^\d$/.test(val)) {
          const parts = current.split(/([+\-×÷])/).filter(Boolean);
          const last = parts[parts.length - 1] || '';
          if (last === '0') {
            if (!last.includes('.')) {
              current = current.slice(0, -1) + val;
              updateDisplays();
              return;
            }
          }
          current += val;
          updateDisplays();
          return;
        }

        if (val === '.') {
          const parts = current.split(/([+\-×÷])/).filter(Boolean);
          const last = parts[parts.length - 1] || '';
          if (last.includes('.')) return;
          if (!last || isOperatorChar(last.slice(-1))) {
            current += '0.';
          } else {
            current += '.';
          }
          updateDisplays();
          return;
        }

        if (isOperatorChar(val)) {
          if (!current && val === '-') {
            current = '-';
            updateDisplays();
            return;
          }
          if (/[+\-×÷]$/.test(current)) {
            current = current.slice(0, -1) + val;
            updateDisplays();
            return;
          }
          current += val;
          updateDisplays();
          return;
        }
      }

      function evaluate() {
        if (!current) return;
        let expr = trimTrailingOperator(current);
        try {
          const jsExpr = toJsExpression(expr);
          const result = Function('"use strict"; return (' + jsExpr + ')')();
          if (!isFinite(result)) throw new Error('Invalid result');
          const final = parseFloat(result.toFixed(10)).toString();
          lastResult = final;
          current = final;
          updateDisplays();
        } catch (e) {
          current = '';
          mainDisplay.textContent = 'Error';
        }
      }

      function del() {
        current = current.slice(0, -1);
        updateDisplays();
      }

      function allClear() {
        current = '';
        updateDisplays();
      }

      function insertAns() {
        if (!lastResult) return;
        const lastChar = current.slice(-1);
        if (/\d|\)/.test(lastChar)) current += '*';
        current += lastResult;
        updateDisplays();
      }

      function applyPercent() {
        if (!current) return;
        const match = current.match(/([0-9]*\.?[0-9]+)$/);
        if (!match) return;
        const numStr = match[1];
        const num = parseFloat(numStr);
        if (Number.isNaN(num)) return;
        const percentVal = (num / 100).toString();
        current = current.slice(0, -numStr.length) + percentVal;
        updateDisplays();
      }

      keys.forEach(btn => {
        btn.addEventListener('click', () => {
          const key = btn.dataset.key;
          if (key === 'AC') allClear();
          else if (key === 'DEL') del();
          else if (key === 'Ans') insertAns();
          else if (key === '%') applyPercent();
          else if (key === '=') evaluate();
          else insert(key);
        });

        btn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            btn.click();
          }
        });
      });

      window.addEventListener('keydown', (e) => {
        const allowed = '0123456789+-*/.%';
        if (allowed.includes(e.key) || e.key === 'Enter' || e.key === 'Backspace' || e.key === 'Escape') {
          e.preventDefault();
        }

        if (/^\d$/.test(e.key)) insert(e.key);
        else if (e.key === '.') insert('.');
        else if (e.key === 'Backspace') del();
        else if (e.key === 'Escape') allClear();
        else if (e.key === 'Enter') evaluate();
        else if (e.key === '%') applyPercent();
        else if (e.key === '+') insert('+');
        else if (e.key === '-') insert('-');
        else if (e.key === '*') insert('×');
        else if (e.key === '/') insert('÷');
      });
      updateDisplays();
    })();
  </script>
</body>
</html>
